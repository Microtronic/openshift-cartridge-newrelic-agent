#!/bin/bash -eu

source $OPENSHIFT_CARTRIDGE_SDK_BASH

# Create additional directories required

mkdir -p ${OPENSHIFT_NEWRELIC_DIR}/logs

# Add javaagent option

HOOKS="${OPENSHIFT_REPO_DIR}/.openshift/action_hooks/pre_start_jbossas
${OPENSHIFT_REPO_DIR}/.openshift/action_hooks/pre_restart_jbossas
${OPENSHIFT_REPO_DIR}/.openshift/action_hooks/pre_reload_jbossas"


for hook in $HOOKS; do
  client_message "Processing $f"

  if [ ! -e "$hook" ]; then
    echo '#!/bin/bash' >> $hook
    chmod 700 $hook 
  fi

  if [ -w "$hook" ]; then
    echo -e "\nsource \${OPENSHIFT_NEWRELIC_DIR}conf/javaagent.conf" >> $hook
  else
    client_message "WARNING: The file $hook is not writable."
  fi
done

